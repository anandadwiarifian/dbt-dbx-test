
      create or replace table test_dbt.hub_order
    
    
    using delta
    
    
    
    
    location '/mnt/adls_ss_finance/SS Finance/test/hub_order'
    
    as
      

-- Generated by dbtvault.

WITH row_rank_1 AS (
    SELECT ORDER_HK, ORDER_ID, LOAD_DATETIME, RECORD_SOURCE
    FROM
    (
        SELECT rr.ORDER_HK, rr.ORDER_ID, rr.LOAD_DATETIME, rr.RECORD_SOURCE,
               ROW_NUMBER() OVER(
                   PARTITION BY rr.ORDER_HK
                   ORDER BY rr.LOAD_DATETIME
               ) AS row_number
        FROM test_dbt.stg_order_product AS rr
        WHERE rr.ORDER_HK IS NOT NULL
    ) h
    WHERE h.row_number = 1
),

records_to_insert AS (
    SELECT a.ORDER_HK, a.ORDER_ID, a.LOAD_DATETIME, a.RECORD_SOURCE
    FROM row_rank_1 AS a
)

SELECT * FROM records_to_insert